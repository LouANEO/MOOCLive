This repository contains code to extract data from the mails extracted from the database of exchanges on the liste XXX@mail.com 
between january 2013 and may 2016.

## CONVERSION

The mails extracted directly from the database are registered in MIME format: we used the software TotalMailConverter to extract data from these files and create .txt files.

## FOLDER "DATA"

The folder "Data" can be downloaded to have the data and the structure of files needed to execute the following bash files.

It contains 7 folders:
- archivesMail (the initial data files)
- TxtData (data converted in .txt)
- Extraction (extracted data)
- DataMining (code for simple analysis on the data)
- Network (code to generate the network of mail exchanges) 
- LanguageProcessing (code and data files for language processing)
- Results (results from analyses)

## HOWTO

### Raw extraction
extractionAdresses.sh and extractionSubject.sh can be launched one after the other in a terminal with the following command:
./extractionAdresses.sh $PATH
./extractionSubject.sh $PATH
(where $PATH is the path of the folder "Data" extracted previously)

They generate the following files:
- adresses.txt, containing 3 columns ($Folder $File $Sender)
- dates.txt, containing 3 columns ($Folder $File $DateOfEmission)
- sub.txt, containing 3 columns ($Folder $File $SubjectOfMail)

In subTemp.txt, the prefixes of the subject were removed, in order to have the same string for each mail of a chain

### Merging
Function merge.r merges the 3 files in a single dataset data.txt, with following columns:
- Folder
- File
- Sender adress
- Date in 6 columns DD\tMM\tYYYY\tHH\tMM\tSS
- Subject 
The function takes one input: a string with the path of folder "Data")

Data are ordered by date of emission

### Data Mining
function runDataMining calls 3 functions in Data/DataMining to perform several temporal aggregation of data, namely:
- aggregation by week and month of all mails
- aggregation by week and month of mails for each thread
- aggregation by week and month of mails posted by each group of the network (if the graph analysis has been performed)

It takes 2 inputs: the path of folder "Data", and an integer (0 or 1) to indicate if the graph analysis has been performed
Graphs and txt files in "Results" are generated by this function to visualize the results of these analyses.

### Graph generation
function networkMail.r generates 2 files "nodesAllNet.txt" and "edgesAllNet.txt", containing the nodes and the edges of the network generated with data.
It takes the path of folder "Data" as an input.

The whole network is hardly interpretable: subGraph.r generates a smaller network composed with the most significant edges only. It creates "nodesWeighted.txt" and "edgesWeighted.txt" in folder Network.
As previous function, it takes the path of folder "Data" as an input.

Gephi can be used to visualize both graphs

### LanguageProcessing
languageProcessing.r calls functions in folder LanguageProcessing to generate word clouds of the words used by users regrouped in the same community by community detection performed on the smaller network identified previously.
It take the path to folder Data, the number of the group of interest and the language of the study as an input.


